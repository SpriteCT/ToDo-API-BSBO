# ToDo API Backend

Backend API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞—Ç—Ä–∏—Ü—ã –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- `main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `database.py` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —á–µ—Ä–µ–∑ async SQLAlchemy
- `models/` ‚Äî SQLAlchemy –º–æ–¥–µ–ª–∏ (`User`, `Task`)
- `routers/` ‚Äî API –º–∞—Ä—à—Ä—É—Ç—ã:
  - `auth.py` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
  - `tasks.py` ‚Äî CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–∞—á–∞–º–∏
  - `stats.py` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–¥–∞—á–∞–º
- `schemas.py`, `schemas_auth.py` ‚Äî Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `scheduler.py` ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞—á
- `utils.py` ‚Äî —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–≤–∞–¥—Ä–∞–Ω—Ç–æ–≤ –∏ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
- `auth_utils.py` ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT –∏ –ø–∞—Ä–æ–ª—è–º–∏
- `dependencies.py` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ FastAPI (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)

## üöÄ –ó–∞–ø—É—Å–∫

### –ß–µ—Ä–µ–∑ Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:
```bash
docker-compose up --build backend
```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
cd backend
python -m venv .venv
.venv\Scripts\activate  # Windows
# –∏–ª–∏
source .venv/bin/activate  # Linux/macOS

pip install -r requirements.txt
```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
# Windows
set DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/postgres
set SECRET_KEY=your-secret-key-here
set PORT=8000  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8000

# Linux/macOS
export DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/postgres
export SECRET_KEY=your-secret-key-here
export PORT=8000  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8000
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
# –ü–æ—Ä—Ç –±—É–¥–µ—Ç –≤–∑—è—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è PORT –∏–ª–∏ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ
uvicorn main:app --host 0.0.0.0 --port ${PORT:-8000} --reload
# –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ (–ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8000)
uvicorn main:app --reload
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000 (–∏–ª–∏ –ø–æ—Ä—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `PORT`)

## üìö API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`/api/v3/auth`)

- `POST /auth/register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /auth/login` ‚Äî –≤—Ö–æ–¥ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω)
- `GET /auth/me` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `PATCH /auth/change-password` ‚Äî —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- `GET /auth/admin/users` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### –ó–∞–¥–∞—á–∏ (`/api/v3/tasks`)

- `GET /tasks` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /tasks/{task_id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –ø–æ ID
- `POST /tasks/` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
- `PUT /tasks/{task_id}` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É
- `PATCH /tasks/{task_id}/complete` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π
- `DELETE /tasks/{task_id}` ‚Äî —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É
- `GET /tasks/quadrant/{Q1|Q2|Q3|Q4}` ‚Äî –∑–∞–¥–∞—á–∏ –ø–æ –∫–≤–∞–¥—Ä–∞–Ω—Ç—É
- `GET /tasks/status/{completed|pending}` ‚Äî –∑–∞–¥–∞—á–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `GET /tasks/search?q=keyword` ‚Äî –ø–æ–∏—Å–∫ –∑–∞–¥–∞—á
- `GET /tasks/today` ‚Äî –∑–∞–¥–∞—á–∏ —Å –¥–µ–¥–ª–∞–π–Ω–æ–º –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (`/api/v3/stats`)

- `GET /stats` ‚Äî –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–æ –∫–≤–∞–¥—Ä–∞–Ω—Ç–∞–º, —Å—Ç–∞—Ç—É—Å–∞–º)
- `GET /stats/deadlines` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å –¥–µ–¥–ª–∞–π–Ω–∞–º–∏
- `GET /stats/timing` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ä–æ–∫–∞–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –°–µ—Ä–≤–∏—Å–Ω—ã–µ

- `GET /` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ API
- `GET /health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- `GET /docs` ‚Äî Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `GET /redoc` ‚Äî ReDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ `/auth/login` —Ç–æ–∫–µ–Ω –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:
```
Authorization: Bearer <your-token>
```

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞

–ó–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –∫–≤–∞–¥—Ä–∞–Ω—Ç–∞–º:
- **Q1** ‚Äî –≤–∞–∂–Ω–æ + —Å—Ä–æ—á–Ω–æ (–¥–µ–¥–ª–∞–π–Ω ‚â§ 3 –¥–Ω–µ–π)
- **Q2** ‚Äî –≤–∞–∂–Ω–æ + –Ω–µ —Å—Ä–æ—á–Ω–æ (–¥–µ–¥–ª–∞–π–Ω > 3 –¥–Ω–µ–π)
- **Q3** ‚Äî –Ω–µ –≤–∞–∂–Ω–æ + —Å—Ä–æ—á–Ω–æ (–¥–µ–¥–ª–∞–π–Ω ‚â§ 3 –¥–Ω–µ–π)
- **Q4** ‚Äî –Ω–µ –≤–∞–∂–Ω–æ + –Ω–µ —Å—Ä–æ—á–Ω–æ (–¥–µ–¥–ª–∞–π–Ω > 3 –¥–Ω–µ–π)

–°—Ä–æ—á–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00 UTC.

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL. –°—Ö–µ–º–∞ –ë–î —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ SQLAlchemy –∏–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç `db/init.sql` –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### –ú–æ–¥–µ–ª–∏

- **User** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (id, nickname, email, hashed_password, role)
- **Task** ‚Äî –∑–∞–¥–∞—á–∏ (id, title, description, is_important, is_urgent, quadrant, completed, deadline_at, user_id)

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `SECRET_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `PORT` ‚Äî –ø–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ FastAPI —Å–µ—Ä–≤–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8000)
- `HOST` ‚Äî —Ö–æ—Å—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.0.0.0)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Ä—Ç —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `BACKEND_PORT` –≤ `.env` —Ñ–∞–π–ª–µ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Docker Compose).

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```bash
curl -X POST "http://localhost:8000/api/v3/auth/register" \
  -H "Content-Type: application/json" \
  -d '{"nickname": "user1", "email": "user@example.com", "password": "password123"}'
```

### –í—Ö–æ–¥
```bash
curl -X POST "http://localhost:8000/api/v3/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=user@example.com&password=password123"
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
```bash
curl -X POST "http://localhost:8000/api/v3/tasks/" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"title": "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞", "is_important": true, "deadline_at": "2025-12-31T18:00:00Z"}'
```
